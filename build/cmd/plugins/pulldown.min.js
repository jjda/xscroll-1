define(function(n,e,t){var o,l=n("../util"),r=n("../base"),i="Pull Down To Refresh",s="Loading...",a=function(n){a.superclass.constructor.call(this,n),this.userConfig=l.mix({content:i,height:60,autoRefresh:!0,downContent:"Pull Down To Refresh",upContent:"Release To Refresh",loadingContent:s,clsPrefix:"xs-plugin-pulldown-"},n)};if(l.extend(a,r,{pluginId:"pulldown",pluginInitializer:function(n){var e=this;return e.xscroll=n.render(),o=e.userConfig.clsPrefix,e.render(),e},pluginDestructor:function(){var n=this;n.pulldown&&n.pulldown.remove(),n.xscroll.off("panstart",n._panStartHandler,n),n.xscroll.off("pan",n._panHandler,n),n.xscroll.off("panend",n._panEndHandler,n),n.__isRender=!1,n._evtBinded=!1,delete n},render:function(){var n=this;if(!n.__isRender){n.__isRender=!0;var e=o+"container",t=n.userConfig.height||60,r=n.pulldown=document.createElement("div");return r.className=e,r.style.position="absolute",r.style.width="100%",r.style.height=t+"px",r.style.lineHeight=t+"px",r.style.top=-t+"px",r.style.textAlign="center",n.xscroll.container.appendChild(r),l.addClass(r,o+n.status),r.innerHTML=n.userConfig[n.status+"Content"]||n.userConfig.content,n._bindEvt(),n}},_bindEvt:function(){var n=this;if(!n._evtBinded){n._evtBinded=!0;var e=(n.pulldown,n.xscroll);e.on("pan",n._panHandler,n),e.on("panstart",n._panStartHandler,n),e.on("panend",n._panEndHandler,n)}},_changeStatus:function(n){var e=this.status;this.status=n,l.removeClass(this.pulldown,o+e),l.addClass(this.pulldown,o+n),this.pulldown.innerHTML=this.userConfig[n+"Content"],e!=n&&(this.trigger("statuschange",{prevVal:e,newVal:n}),"loading"==n&&this.trigger("loading"))},reset:function(n){return this.xscroll.boundry.resetTop(),this.xscroll.bounce(!0,n),this._expanded=!1,this},_panStartHandler:function(){clearTimeout(this.loadingItv)},_panHandler:function(n){var e=this;n.scrollTop>0||e._changeStatus(Math.abs(n.scrollTop)<e.userConfig.height?"down":"up")},_panEndHandler:function(n){var e=this,t=e.xscroll,o=e.userConfig.height||60,l=t.getScrollTop();-o>l&&(n.preventDefault(),t.boundry.resetTop(),t.boundry.expandTop(o),t.boundryCheckY(function(){e._changeStatus("loading")}),e.userConfig.autoRefresh&&(clearTimeout(e.loadingItv),e.loadingItv=setTimeout(function(){t.boundry.resetTop(),t.boundryCheckY(function(){window.location.reload()})},800)))}}),"object"==typeof t&&t.exports)t.exports=a;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.PullDown=a});
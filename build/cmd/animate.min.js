define(function(t,r,e){function n(t){return Math.round(1e5*parseFloat(t))/1e5}function a(){return{translateX:0,translateY:0,rotate:0,skewX:0,skewY:0,scaleX:1,scaleY:1}}function s(t){return t=t.split(/,/),t=Array.prototype.map.call(t,function(t){return n(t)})}function i(t){t=s(t);var r,e,a,i=t[0],o=t[1],l=t[2],c=t[3];return i*c-o*l?(r=Math.sqrt(i*i+o*o),a=(i*l+o*c)/(i*c-l*o),e=(i*c-o*l)/r,o*l>i*c&&(a=-a,r=-r)):r=e=a=0,{translateX:n(t[4]),translateY:n(t[5]),rotate:n(180*Math.atan2(o,i)/Math.PI),skewX:n(180*Math.atan(a)/Math.PI),skewY:0,scaleX:n(r),scaleY:n(e)}}function o(t){t=t.split(")");for(var r,e,s,o=d.trim,l=-1,c=t.length-1,u=a();++l<c;)switch(r=t[l].split("("),e=o(r[0]),s=r[1],e){case"translateX":case"translateY":case"scaleX":case"scaleY":u[e]=n(s);break;case"translate":case"translate3d":s=s.split(","),u.translateX=n(s[0]),u.translateY=n(s[1]||0);break;case"scale":s=s.split(","),u.scaleX=n(s[0]),u.scaleY=n(s[1]||s[0]);break;case"matrix":return i(s)}return u}function l(t,r){if(t&&r&&r.css){var e=this;e.cfg=r,e.el=t;{var n=r.duration||0,a=r.easing||"ease";r.delay||0}return r.run&&(e.timer=e.timer||new m({duration:Math.round(n),easing:a}),e.timer.on("run",r.run)),e._bindEvt(),e}}function c(t,r){var e=o(t),n=o(r),a={};for(var s in n)a[s]={prevVal:e[s],newVal:n[s]};return a}function u(t,r,e,n,a){e=isNaN(Number(e))?0:Number(e);var s=(n-e)*a+e;f(t,r,s)}function f(t,r,e){switch(r){case"scrollTop":case"scrollLeft":t[r]=e;break;case"transform":t.style[_]=e;case"opacity":t.style[r]=e}}var d=t("./util"),m=t("./timer"),p=t("./easing"),v=t("./base"),_=d.prefixStyle("transform"),g=d.prefixStyle("transition"),h=(d.prefixStyle("transitionDuration"),d.prefixStyle("transformOrigin"),d.vendor?d.prefixStyle("transitionEnd"):"transitionend"),y=(d.vendor?["-",d.vendor,"-transform"].join(""):"transform","translateX({translateX}px) translateY({translateY}px) translateZ(0)"),b={transform:!0,opacity:!0,scrollTop:!0,scrollLeft:!0};return d.extend(l,v,{run:function(){var t=this,r=t.cfg,e=t.el,n=r.duration||0,a=r.easing||"ease",s=r.delay||0;if(t.__isTransitionEnd=!1,clearTimeout(t.__itv),t.timer&&t.timer.run(),n<=m.MIN_DURATION){for(var i in r.css)f(e,i,r.css[i]);return t.stop(),void t.__handlers.stop.call(t)}if(r.useTransition){e.style[g]=d.substitute("all {duration}ms {easing} {delay}ms",{duration:Math.round(n),easing:p.format(a),delay:s});for(var i in r.css)f(e,i,r.css[i]);t.__itv=setTimeout(function(){t.__isTransitionEnd||(t.__isTransitionEnd=!0,t.trigger("transitionend"))},Number(n)+60)}else{var o=window.getComputedStyle(e);if(r.css.transform){{t.transmap=c(o[_],r.css.transform)}t.timer&&t.timer.off("run",t.__handlers.transRun),t.timer&&t.timer.on("run",t.__handlers.transRun,t)}}return t},_transitionEndHandler:function(){var t=this;t.stop(),t.__handlers.stop.call(t)},__handlers:{transRun:function(t){var r=this,e=r.transmap,n=r.el,a={};for(var s in e)a[s]=(e[s].newVal-e[s].prevVal)*t.percent+e[s].prevVal;var i=d.substitute(y+" scale({scaleX},{scaleY})",a);n.style[_]=i},stop:function(){var t=this,r=t.cfg;r.end&&r.end({percent:1})}},_bindEvt:function(){var t=this,r=t.cfg;t.el.addEventListener(h,function(r){t.__isTransitionEnd=!0,r.target===r.currentTarget&&t.trigger("transitionend",r)}),t.on("transitionend",t._transitionEndHandler,t);var e=function(t){for(var e in r.css)/transform/.test(e)||u(el,e,computeStyle[e],r.css[e],t.percent)};t.timer&&t.timer.on("run",e),t.timer&&t.timer.on("stop",t.__handlers.stop,t)},stop:function(){var t=this;if(t.cfg.useTransition&&t.cfg.duration>m.MIN_DURATION){var r=window.getComputedStyle(this.el);for(var e in t.cfg.css)if(b[e]){var n=/transform/.test(e)?r[_]:r[e];f(t.el,e,d.substitute(y+" scale({scaleX},{scaleY})",o(n)))}t.el.style[g]="none"}return t.timer&&t.timer.stop()&&t.timer.reset(),t},reset:function(t){var r=this;return d.mix(r.cfg,t),this.timer&&r.timer.reset({duration:Math.round(r.cfg.duration),easing:r.cfg.easing}),r}}),"object"==typeof e&&e.exports?void(e.exports=l):l});